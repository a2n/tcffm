--- Log opened 日 11月 09 00:00:48 2014
10:55 < hmchen> 有人用過 zswap 嗎? 是否要搭配 hdd swap 才有效?
10:59 < hmchen> 剛剛寫了個程式, 每次吃 2GB 記憶體. 系統 RAM 8GB, 結果 run 到第 4 個 process 時 malloc 就要不到記憶體了
15:57 < guildwar> 有試過用 debugfs 裡的資訊來 debug 嗎?
15:57 < guildwar> A debugfs interface is provided for various statistic about pool size, number
15:57 < guildwar> of pages stored, and various counters for the reasons pages are rejected.
15:57 < guildwar> mkdir /tmp/debug
15:57 < guildwar> mount -t debugfs debugfs /tmp/debug
15:58 < guildwar> cat /tmp/debug/zswap/pool_limit_hit
15:58 < guildwar> 我不大懂運作原理，你這個好像可以用來 debug
22:34 < hmchen> 剛剛掛上了 swap, 有看到數值變化了, 看起來 zswap 還是得要搭配 swap 使用才行
22:38 < guildwar> 應該也是，都叫 zswap，不然應該叫 zram 之類的 :)
22:39 < hmchen> zswap應該視為 main memory 跟 swap partition 之間的緩衝+壓縮器
22:40 < hmchen> 當 pool 不夠用時還是會寫回 swap partition
22:40 < hmchen> 優點是減少 swap parition 的 i/o 次數
22:41 < hmchen> 對 hdd 或 ssd 都有幫助, cpu 壓縮比較 disk i/o 快, 而減少 i/o 次數可以延長 ssd 壽命
22:41 < hmchen> 確實有 zram , 我還在看
22:43 < hmchen> 我的目的是, 不掛 swap partition 但某種程度上仍可以稍微用超過實體記憶體大小
22:47 < hmchen> http://wiki.gentoo.org/wiki/Zram
22:49 < hmchen> zram跟我想要的用法不太一樣, zram 是把指定的 memory size 變成 block device, 然後就可掛成 swap 或 ext4 等其他 fs
22:51 < hmchen> 缺點是... ram 就真的直接挖走了,
22:52 < guildwar> 好像一樣要 swap，　So, 1G of swap uses only 333MB of ram on average
22:54 < hmchen> 舉個例子來說, 8G 的 ram 切程 6G + 2G zram, 當配置記憶體超過 6G 但還沒到達 8G, 理論上空間還有剩, 但因為 swap 在 zram 上, 超過 6G 就會開始觸發 page fault/swap 跟壓縮了
22:55 < guildwar> 那這樣 ok 啊，沒用到 disk
